<!DOCTYPE html>
<html>
<head>
  <title>GMB Dashboard</title>
  <meta charset="utf-8">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:800px;margin:auto;padding:20px}
    label{display:block;margin-top:15px}
    input[type=file]{margin-top:5px}
    #aiOutput{border:1px solid #ccc;padding:10px;margin-top:10px;min-height:60px;background:#f9f9f9}
  </style>
</head>
<body>
  <h1>Schedule a GMB Post</h1>

  <label>When to publish</label>
  <input type="datetime-local" id="scheduleDate" required>

  <label>Upload image (optional)</label>
  <input type="file" id="imageFile" accept="image/*">

  <label>What should the post say?</label>
  <textarea id="userPrompt" rows="3" placeholder="e.g. Grand opening this Saturday!"></textarea>
  <button onclick="generatePost()">âœ¨ Generate post with AI</button>

  <label>Final text</label>
  <div id="aiOutput" contenteditable="true">(AI writes here)</div>

  <button onclick="publishNow()" style="margin-top:20px;background:#34A853;color:white">ðŸš€ Publish NOW to GMB</button>

  <button onclick="schedulePost()" style="margin-top:20px">ðŸ“… Schedule Post</button>

  <script>
    function generatePost(){
      const prompt = document.getElementById('userPrompt').value || 'Exciting update from our business!';
      fetch('/api/ai',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt})})
        .then(r=>r.json()).then(d=>document.getElementById('aiOutput').innerText=d.text);
    }
    function schedulePost(){
      const data={
        when: document.getElementById('scheduleDate').value,
        text: document.getElementById('aiOutput').innerText,
        image: document.getElementById('imageFile').files[0]
      };
      fetch('/api/schedule',{method:'POST',body:JSON.stringify(data),headers:{'Content-Type':'application/json'}})
        .then(r=>r.json()).then(d=>alert(d.msg||'Scheduled!'));
    }
  </script>
  <script>
  async function publishNow(){
    const text = document.getElementById('aiOutput').innerText;
    const res = await fetch('/api/publish',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text})});
    const json = await res.json();
    alert(json.msg || json.error);
  }
</script>
</body>
</html>
