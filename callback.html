<body>
  <script>
    // grab ?code=... from URL
    const params = new URLSearchParams(location.search);
    const code = params.get('code');
    if (!code) { document.body.innerHTML = 'Missing code'; throw 0; }

    // swap code for token (server-side)
    fetch('/api/exchange',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code})})
      .then(r=>r.json()).then(d=>{
        // save token
        fetch('/api/token',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token:d.access_token})})
          .then(()=>window.location='/dashboard.html');
      });
  </script>
  <p>Connectingâ€¦ please wait.</p>
</body>
